/*!
 * Ajax Bootstrap Select
 *
 * Extends the bootstrap-select plugin so it can use a remote source for searching. Originally for CROSCON.
 *
 * @version 1.2.0
 * @author Adam Heim - https://github.com/truckingsim
 * @link https://github.com/truckingsim/Ajax-Bootstrap-Select
 * @copyright 2014 Adam Heim
 * @license Released under the MIT license.
 *
 * Contributors:
 *   Mark Carver - https://github.com/markcarver
 *
 * Last build: 2014-09-24 12:28:18 PM CDT
 */
!function(a,b){var c=function(c,e){var f,g=this;if(this.options={},e=e||{},this.LOG_ERROR=1,this.LOG_WARNING=2,this.LOG_INFO=3,this.LOG_DEBUG=4,this.$element=a(c),this.$loading=a(),this.$noResults=a(),this.previousQuery="",this.query="",this.selectpicker=this.$element.data("selectpicker"),!this.selectpicker)return void this.log(this.LOG_ERROR,"Cannot attach ajax without selectpicker being run first!");f={ajaxOptions:{url:null,type:"POST",dataType:"json",data:{q:"{{{q}}}"}},bindEvent:"keyup",cache:!0,clearOnEmpty:!0,emptyRequest:!1,ignoredKeys:{9:"tab",16:"shift",17:"ctrl",18:"alt",27:"esc",37:"left",39:"right",38:"up",40:"down",91:"meta",229:"unknown"},langCode:null,locale:null,log:"error",preprocessData:null,preserveSelected:!0,preserveSelectedPosition:"after",processData:null,requestDelay:300,templates:{loading:'<div class="menu-loading">Loading...</div>',noResults:'<div class="no-results">No Results</div>'}},this.options=a.extend(!0,{},f,e);var h=[{from:"ajaxResultsPreHook",to:"preprocessData"},{from:"ajaxSearchUrl",to:{ajaxOptions:{url:"{{{value}}}"}}},{from:"debug",to:function(b){var c={};c.log=Boolean(g.options[b.from])?g.LOG_DEBUG:0,a.extend(g.options,c),delete g.options[b.from],g.log(g.LOG_WARNING,'Deprecated option "'+b.from+'". Update code to use:',c)}},{from:"mixWithCurrents",to:"preserveSelected"},{from:"placeHolderOption",to:function(b){var c={templates:{noResults:'<div class="no-results">'+e[b.from]+"</div>"}};a.extend(g.options,c),delete g.options[b.from],g.log(g.LOG_WARNING,'Deprecated option "'+b.from+'". Update code to use:',c)}}];if(h.length&&a.map(h,function(b){if(g.options[b.from])if(a.isPlainObject(b.to))g.replaceValue(b.to,"{{{value}}}",g.options[b.from]),g.options=a.extend(!0,{},g.options,b.to),g.log(g.LOG_WARNING,'Deprecated option "'+b.from+'". Update code to use:',b.to),delete g.options[b.from];else if(a.isFunction(b.to))b.to.apply(g,[b]);else{var c={};c[b.to]=g.options[b.from],a.extend(g.options,c),g.log(g.LOG_WARNING,'Deprecated option "'+b.from+'". Update code to use:',c),delete g.options[b.from]}}),this.$element.data("searchUrl")&&(this.options.ajaxOptions.url=this.$element.data("searchUrl")),"number"!=typeof this.options.log)switch("string"==typeof this.options.log&&(this.options.log=this.options.log.toLowerCase()),this.options.log){case!0:case"debug":this.options.log=this.LOG_DEBUG;break;case"info":this.options.log=this.LOG_INFO;break;case"warn":case"warning":this.options.log=this.LOG_WARNING;break;default:case!1:case"error":this.options.log=this.LOG_ERROR}if(!this.options.ajaxOptions.url)return void this.log(this.LOG_ERROR,"ajaxOptions.url must be set! Options:",this.options);if(this.locale=a.extend(!0,{},a.fn.ajaxSelectPicker.locale),this.options.langCode=this.options.langCode||b.navigator.userLanguage||b.navigator.language||"en",!this.locale[this.options.langCode]){var i=this.options.langCode;this.options.langCode="en";var j,k=i.split("-"),l=k.length;for(j=0;l>j;j++){var m=k.join("-");if(m.length&&this.locale[m]){this.options.langCode=m;break}k.pop()}this.log(this.LOG_WARNING,'Unknown langCode option: "'+i+'". Using the following langCode instead: "'+this.options.langCode+'".')}this.locale[this.options.langCode]=a.extend(!0,{},this.locale[this.options.langCode],this.options.locale),this.list=new d(this),setTimeout(function(){g.init()},500)};b.AjaxBootstrapSelect=b.AjaxBootstrapSelect||c,c.prototype.init=function(){var b,c=this;this.options.preserveSelected&&this.selectpicker.$menu.off("click",".actions-btn").on("click",".actions-btn",function(b){c.selectpicker.options.liveSearch?c.selectpicker.$searchbox.focus():c.selectpicker.$button.focus(),b.preventDefault(),b.stopPropagation(),a(this).is(".bs-select-all")?(null===c.selectpicker.$lis&&(c.selectpicker.$lis=c.selectpicker.$menu.find("li")),c.$element.find("option:enabled").prop("selected",!0),a(c.selectpicker.$lis).not(".disabled").addClass("selected"),c.selectpicker.render()):(null===c.selectpicker.$lis&&(c.selectpicker.$lis=c.selectpicker.$menu.find("li")),c.$element.find("option:enabled").prop("selected",!1),a(c.selectpicker.$lis).not(".disabled").removeClass("selected"),c.selectpicker.render()),c.selectpicker.$element.change()}),this.selectpicker.$searchbox.attr("placeholder",this.t("searchPlaceholder")).off("input propertychange"),this.selectpicker.$searchbox.on(this.options.bindEvent,function(a){var d=c.selectpicker.$searchbox.val();if(c.log(c.LOG_DEBUG,'Bind event fired: "'+c.options.bindEvent+'", keyCode:',a.keyCode,a),c.options.cache||(c.options.ignoredKeys[13]="enter"),c.options.ignoredKeys[a.keyCode])return void c.log(c.LOG_DEBUG,"Key ignored.");if(clearTimeout(b),d.length||(c.options.clearOnEmpty&&c.list.destroy(),c.options.emptyRequest)){if(c.previousQuery=c.query,c.query=d,c.options.cache&&13!==a.keyCode){var f=c.list.cacheGet(c.query);if(f)return c.list.replaceOptions(f)?void c.log(c.LOG_INFO,"Rebuilt options from cached data."):(c.log(c.LOG_WARNING,"Unable to rebuild options from cached data."),void c.list.restore())}b=setTimeout(function(){c.lastRequest=new e(c)},c.options.requestDelay||300)}})},c.prototype.log=function(a,c){if(this.options.log&&b.console&&"number"==typeof a&&a<=this.options.log){var d=[].slice.apply(arguments,[2]);switch(a){case this.LOG_DEBUG:a="debug";break;case this.LOG_INFO:a="info";break;case this.LOG_WARNING:a="warn";break;default:case this.LOG_ERROR:a="error"}var e="["+a.toUpperCase()+"] AjaxBootstrapSelect:";"string"==typeof c?d.unshift(e+" "+c):(d.unshift(c),d.unshift(e)),b.console[a].apply(b.console,d)}},c.prototype.replaceValue=function(b,c,d,e){var f=this;e=a.extend({recursive:!0,depth:!1,limit:!1},e),a.each(b,function(g,h){return e.limit!==!1&&"number"==typeof e.limit&&e.limit<=0?!1:void(a.isArray(b[g])||a.isPlainObject(b[g])?(e.recursive&&e.depth===!1||e.recursive&&"number"==typeof e.depth&&e.depth>0)&&f.replaceValue(b[g],c,d,e):h===c&&(e.limit!==!1&&"number"==typeof e.limit&&e.limit--,b[g]=d))})},c.prototype.t=function(a,b){return b=b||this.options.langCode,this.locale[b]&&this.locale[b][a]?this.locale[b][a]:(this.log(this.LOG_WARNING,"Unknown translation key:",a),a)};var d=function(b){var c=this;this.cache={"":[]},this.plugin=b,this.selected=[],b.options.preserveSelected&&b.$element.on("change.abs.preserveSelected",function(){var d=b.$element.find(":selected");c.selected=[],b.selectpicker.multiple||(d=d.last()),d.each(function(){var b=a(this),d=b.attr("value");c.selected.push({value:d,text:b.text(),"class":b.attr("class")||"",data:b.data()||{},preserved:!0,selected:!0})}),c.replaceOptions(c.cacheGet(c.plugin.query))})};b.AjaxBootstrapSelectList=b.AjaxBootstrapSelectList||d,d.prototype.build=function(b){var c,d,e=b.length,f=a("<select/>"),g=a("<optgroup/>").attr("label",this.plugin.t("currentlySelected"));for(this.plugin.log(this.plugin.LOG_DEBUG,"Building the select list options from data:",b),d=0;e>d;d++){var h=b[d],i=a("<option/>").appendTo(h.preserved?g:f);if(h.hasOwnProperty("divider"))i.attr("data-divider","true");else{i.val(h.value).text(h.text),h.class.length&&i.attr("class",h.class),h.disabled&&i.attr("disabled",!0),h.selected&&!this.plugin.selectpicker.multiple&&f.find(":selected").prop("selected",!1),h.selected&&i.attr("selected",!0);for(c in h.data)h.data.hasOwnProperty(c)&&i.attr("data-"+c,h.data[c])}}g.find("option").length&&g["before"===this.plugin.options.preserveSelectedPosition?"prependTo":"appendTo"](f);var j=f.html();return this.plugin.log(this.plugin.LOG_DEBUG,j),j},d.prototype.cacheGet=function(a,b){var c=this.cache[a]||b;return this.plugin.log(this.LOG_DEBUG,"Retrieving cache:",a,c),c},d.prototype.cacheSet=function(a,b){this.cache[a]=b,this.plugin.log(this.LOG_DEBUG,"Saving to cache:",a,b)},d.prototype.destroy=function(){this.replaceOptions(),this.plugin.log(this.plugin.LOG_DEBUG,"Destroyed select list.")},d.prototype.refresh=function(){this.plugin.selectpicker.$menu.css("minHeight",0),this.plugin.selectpicker.$menu.find("> .inner").css("minHeight",0),this.plugin.selectpicker.refresh(),this.plugin.selectpicker.findLis?this.plugin.selectpicker.findLis():this.plugin.selectpicker.$lis=this.plugin.selectpicker.$menu.find("li"),this.plugin.$element.trigger("change.$"),this.plugin.log(this.plugin.LOG_DEBUG,"Refreshed select list.")},d.prototype.replaceOptions=function(a){var b,c,d,e="",f=[],g=[],h=[];if(a=a||[],this.selected&&this.selected.length){for(this.plugin.log(this.plugin.LOG_INFO,"Processing preserved selections:",this.selected),g=[].concat(this.selected,a),c=g.length,b=0;c>b;b++)d=g[b],d.hasOwnProperty("value")&&-1===h.indexOf(d.value+"")?(h.push(d.value+""),f.push(d)):this.plugin.log(this.plugin.LOG_DEBUG,"Duplicate item found, ignoring.");a=f}a.length&&(e=this.plugin.list.build(a)),this.plugin.$element.html(e),this.refresh(),this.plugin.log(this.plugin.LOG_DEBUG,"Replaced options with data:",a)},d.prototype.restore=function(){return this.plugin.list.replaceOptions(this.plugin.list.cacheGet(this.plugin.previousQuery))&&this.plugin.log(this.plugin.LOG_DEBUG,"Restored select list to the previous query: ",this.plugin.previousQuery),this.plugin.log(this.plugin.LOG_DEBUG,"Unable to restore select list to the previous query:",this.plugin.previousQuery),!1};var e=function(b){var c,d=this,e=function(a){return function(){d.plugin.log(d.plugin.LOG_INFO,"Invoking AjaxBootstrapSelectRequest."+a+" callback:",arguments),d[a].apply(d,arguments),d.callbacks[a]&&(d.plugin.log(d.plugin.LOG_INFO,"Invoking ajaxOptions."+a+" callback:",arguments),d.callbacks[a].apply(d,arguments))}},f=["beforeSend","success","error","complete"],g=f.length;for(this.plugin=b,this.options=a.extend(!0,{},b.options.ajaxOptions),this.callbacks={},c=0;g>c;c++){var h=f[c];this.options[h]&&a.isFunction(this.options[h])&&(this.callbacks[h]=this.options[h]),this.options[h]=e(h)}this.options.data&&a.isFunction(this.options.data)&&(this.options.data=this.options.data.apply(this)||{q:"{{{q}}}"}),this.plugin.replaceValue(this.options.data,"{{{q}}}",this.plugin.query),this.jqXHR=a.ajax(this.options)};b.AjaxBootstrapSelectRequest=b.AjaxBootstrapSelectRequest||e,e.prototype.beforeSend=function(){this.plugin.list.destroy(),this.plugin.$loading.remove(),this.plugin.$noResults.remove(),this.plugin.options.templates.loading&&(this.plugin.$loading=a(this.plugin.options.templates.loading).appendTo(this.plugin.selectpicker.$menu),this.plugin.list.refresh())},e.prototype.complete=function(){this.plugin.$loading.remove(),this.plugin.list.refresh()},e.prototype.error=function(){this.plugin.list.restore()},e.prototype.process=function(b){var c,d,e,f,g,h,i=[],j=[];if(this.plugin.log(this.plugin.LOG_INFO,"Processing raw data for:",this.plugin.query,b),a.isPlainObject(b))e=[].concat(a.map(b,function(a){return[a]}));else{if(!a.isArray(b))return this.plugin.log(this.plugin.LOG_ERROR,"The data type passed was not an Array or Object.",b),!1;e=[].concat(b)}if(g=[].concat(e),a.isFunction(this.plugin.options.preprocessData)&&(this.plugin.log(this.plugin.LOG_DEBUG,"Invoking preprocessData callback:",this.plugin.options.processData),g=this.plugin.options.preprocessData(g),!a.isArray(g)||!g.length))return this.plugin.log(this.plugin.LOG_ERROR,"The preprocessData callback did not return an array or was empty.",b,g),!1;for(d=g.length,c=0;d>c;c++)f=g[c],this.plugin.log(this.plugin.LOG_DEBUG,"Processing item:",f),a.isPlainObject(f)&&(f.hasOwnProperty("divider")||f.hasOwnProperty("data")&&a.isPlainObject(f.data)&&f.data.divider?(this.plugin.log(this.plugin.LOG_DEBUG,"Item is a divider, ignoring provided data."),i.push({divider:!0})):f.hasOwnProperty("value")?-1===j.indexOf(f.value+"")?(j.push(f.value+""),f=a.extend({text:f.value,"class":"",data:{},disabled:!1,selected:!1},f),i.push(f)):this.plugin.log(this.plugin.LOG_DEBUG,"Duplicate item found, ignoring."):this.plugin.log(this.plugin.LOG_DEBUG,'Data item must have a "value" property, skipping.'));return h=[].concat(i),!a.isFunction(this.plugin.options.processData)||(this.plugin.log(this.plugin.LOG_DEBUG,"Invoking processData callback:",this.plugin.options.processData),h=this.plugin.options.processData(h),a.isArray(h)&&h.length)?(this.plugin.list.cacheSet(this.plugin.query,h),this.plugin.log(this.plugin.LOG_INFO,"Processed data:",h),h):(this.plugin.log(this.plugin.LOG_ERROR,"The processedData callback did not return an array or was empty.",b,i,h),!1)},e.prototype.success=function(b){if(!a.isArray(b)&&!a.isObject(b))return this.plugin.log(this.plugin.LOG_ERROR,"Request did not return a JSON Array or Object.",b),void this.plugin.list.destroy();if(!Object.keys(b).length)return this.plugin.list.destroy(),this.plugin.options.templates.noResults&&(this.plugin.$noResults=a(this.plugin.options.templates.noResults).appendTo(this.plugin.selectpicker.$menu)),void this.plugin.log(this.plugin.LOG_INFO,"No results were returned.");var c=this.process(b);this.plugin.list.replaceOptions(c)},a.fn.ajaxSelectPicker=function(c){return this.each(function(){a(this).data("AjaxBootstrapSelect")||a(this).data("AjaxBootstrapSelect",new b.AjaxBootstrapSelect(this,c))})},a.fn.ajaxSelectPicker.locale={},/*!
 * English translation for the "en" language code.
 * Mark Carver <mark.carver@me.com>
 */
a.fn.ajaxSelectPicker.locale["en-US"]={currentlySelected:"Currently Selected",noResults:"No Results",searchPlaceholder:"Search...",searching:"Searching..."},a.fn.ajaxSelectPicker.locale.en=a.fn.ajaxSelectPicker.locale["en-US"]}(jQuery,window);